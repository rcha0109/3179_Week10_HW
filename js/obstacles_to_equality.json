{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "autosize": {"type": "fit", "contains": "content"},
  "config": {
    "view": {"stroke": null}
  },
  "vconcat": [
    {
      "width": 800,
      "height": 330,
      "data": {
        "url": "https://raw.githubusercontent.com/rcha0109/3179_W9/main/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "projection": {"type": "equalEarth"},
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
            "format": {"type": "topojson", "feature": "oceans"}
          },
          "mark": {"type": "geoshape", "fill": "skyblue"}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/rcha0109/3179_Week10_HW/main/js/WorldMapWithGraticules.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
          },
          "mark": {"type": "geoshape", "fill": null, "stroke": "lightgray"}
        },
        {
          "transform": [
            {
              "lookup": "properties.NAME",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/rcha0109/3179_Week10_HW/main/data/Obstacles_cleaned.csv"
                },
                "key": "Country",
                "fields": ["MainObstacle"]
              }
            },
            {
              "calculate": "datum.MainObstacle == null ? 'Not Available' : datum.MainObstacle",
              "as": "MainObstacle"
            }
          ],
          "selection": {
            "obstacle_selection": {
              "type": "multi",
              "fields": ["MainObstacle"],
              "bind": "legend"
            }
          },
          "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
          "encoding": {
            "color": {
              "field": "MainObstacle",
              "type": "nominal",
              "scale": {
                "domain": [
                  "Unequal Responsibilities",
                  "Unequal Employment Opportunities",
                  "Religion and Culture",
                  "Different Treatment Growing Up",
                  "Not Available"
                ],
                "range": ["#1f77b4", "#00bfae", "#ff7f0e", "#9467bd", "lightgray"]
              },
              "legend": {"title": "Perceived Obstacles", "titleFontSize": 16,  "orient": "top", "offset": 0, "labelFontSize": 12, "padding": 7, "labelLimit": 1000}
            },
            "opacity": {
              "condition": {"selection": "obstacle_selection", "value": 1},
              "value": 0.65
            },
            "tooltip": [
              {"field": "properties.NAME", "type": "nominal", "title": "Country"},
              {"field": "MainObstacle", "type": "nominal", "title": "Main Obstacle"}
            ]
          }
        }
      ]
    },
    {
      "hconcat": [
        {
          "title": {
            "text": "Does Progress Mean Equality?",
            "subtitle": "Exploring the link between human development, education and gender inequality.",
            "anchor": "start",
            "font": "Nunito Sans",
            "fontSize": 20,
            "fontWeight": 700,
            "subtitleFont": "Nunito Sans",
            "subtitleFontSize": 14,
            "subtitleFontStyle": "italic",
            "subtitleColor": "gray",
            "offset": 15
          },
          "width": 500,
          "height": 250,
          "data": {
            "url": "https://raw.githubusercontent.com/rcha0109/3179_Week10_HW/main/data/GII_cleaned.csv"
          },
          "transform": [
            {
              "lookup": "Country",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/rcha0109/3179_Week10_HW/main/data/Obstacles_cleaned.csv"
                },
                "key": "Country",
                "fields": ["MainObstacle"]
              }
            },
            {
              "calculate": "datum.MainObstacle == null ? 'Not Available' : datum.MainObstacle",
              "as": "MainObstacle"
            },
            {"calculate": "datum['Mean Years of Schooling Female']", "as": "Schooling"}
          ],
          "layer": [
            {
              "mark": {"type": "circle", "stroke": "white", "strokeWidth": 1, "opacity": 0.5},
              "selection": {
                "obstacle_selection": {"type": "multi", "fields": ["MainObstacle"], "bind": "legend"}
              },
              "encoding": {
                "x": {
                  "field": "Human Development Index Female",
                  "type": "quantitative",
                  "scale": {"domain": [0, 1]},
                  "title": "Female Human Development Index (HDI)",
                  "axis": {"titleFontSize": 12}
                },
                "y": {
                  "field": "Gender Inequality Index",
                  "type": "quantitative",
                  "scale": {"domain": [0, 1], "reverse": true},
                  "axis": {"titleFontSize": 12}
                },
                "color": {
                  "field": "MainObstacle",
                  "type": "nominal",
                  "scale": {
                    "domain": [
                      "Unequal Responsibilities",
                      "Unequal Employment Opportunities",
                      "Religion and Culture",
                      "Different Treatment Growing Up",
                      "Not Available"
                    ],
                    "range": ["#1f77b4", "#00bfae", "#ff7f0e", "#9467bd", "lightgray"]
                  }
                },
                "size": {
                  "field": "Schooling",
                  "type": "quantitative",
                  "scale": {"range": [30, 800]},
                  "legend": { "title": "Mean Years of Schooling Female", "orient": "bottom", "offset": 20, "direction": "horizontal", "titleFontSize": 11, "titleLimit": 1000}
                },
                "opacity": {
                  "condition": {"selection": "obstacle_selection", "value": 0.8},
                  "value": 0.25
                },
                "order": {
                  "condition": {"test": "datum.MainObstacle != 'Not Available'", "value": 1},
                  "value": 0
                },
                "tooltip": [
                  {"field": "Country", "type": "nominal"},
                  {"field": "MainObstacle", "type": "nominal", "title": "Main Perceived Obstacle"},
                  {"field": "Gender Inequality Index", "type": "quantitative"},
                  {"field": "Human Development Index Female", "type": "quantitative", "title": "Female HDI"},
                  {"field": "Schooling", "type": "quantitative", "title": "Mean Female Schooling"}
                ]
              }
            },
            {
              "data": {"values": [{"x": 0.8}, {"x": 0.7}, {"x": 0.55}]},
              "mark": {"type": "rule", "color": "darkgray", "size": 2, "opacity": 0.55, "strokeDash": [6, 4]},
              "encoding": {"x": {"field": "x", "type": "quantitative"}}
            },
            {
              "data": {
                "values": [
                  {"x": 0.875, "label": "Very High"},
                  {"x": 0.75, "label": "High"},
                  {"x": 0.625, "label": "Medium"},
                  {"x": 0.275, "label": "Low"},
                  {"x": 0.03, "label": "HDI:"}
                ]
              },
              "mark": {"type": "text", "align": "center", "baseline": "bottom", "dy": -15, "color": "gray"},
              "encoding": {
                "x": {"field": "x", "type": "quantitative"},
                "y": {"value": 10},
                "text": {"field": "label"}
              }
            }
          ]
        }
      ]
    }
  ],
  "resolve": {"scale": {"x": "independent", "y": "independent", "color": "shared"}}
}
